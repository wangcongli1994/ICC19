\section{Discussion and Suggestion}
In the experiment, we found that different browsers have different processing methods for some unsafe scenarios. Through comparison between them, we have summarized the existing risks of several browsers.

\subsection{Weak Algorithm}
    Several security incidents have shown that,
        attackers can use SHA-1 and MD5 to colliding fraudulent certificates,
    but Edge and IE don't display any warnings on certificates with SHA-1/MD5 signatures.
    Edge and IE need to be improved on this.

    RSA512 have been broken since 2009 \cite{cavallar2000factorization}, but Chrome, Edge, and IE display only B-level (Medium-risk) warnings, we think the risk level of RSA512 is C-level (High-risk).

    RSA1024 is expectable to be broken within 2015 to 2020 \cite{Berlin2017An},
    but all the four browsers don't display any warnings on certificates with RSA1024 keys.
    They need to be improved on this.


%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Self-signed Server Certificate}
    Users can install self-signed server certificates to OS root store, Chrome,
        Edge, and IE will treat them secure.
    However, when FireFox encounters a website using a self-signed certificate,
        the only way to make it work is adding a Security Exception for that particular website.
    We think Firefox need to be improved on this.
%For a self-signed server certificate, it is both a root certificate and a CA certificate. This type of certificate can be added to the "Trusted Root Certification Authorities" store on Windows systems and made available to Chrome and Edge browsers for secure access. Firefox has a self-built certificate manager, but the manager does not store the server certificate in the certificate store. That is, if you need Firefox to trust a self-signed certificate, you must sign a server certificate by using the CA certificate, and install the root CA certificate into the certificate manager of the Firefox browser.

%When FireFox encounters a self-signed cert, it won't load the page. The way to make it work is to add a Security Exception for that particular website.

%The NSS root certificate store

\subsection{Revoked Server Certificate}
    99.9\% of the server certificates contains a CRL distribution point \cite{liu2015end},
        however, Chrome and Firefox don't display any warnings on revoked server certificates through CRL.
        we think Chrome and Firefox need to be improved on this.

    95\% of the server certificates contains a OCSP responder \cite{liu2015end},
        however, Chrome does not display any warnings on revoked server certificates through OCSP.
        we think Chrome need to be improved on this.

    CRLSet only covers 0.35\% of all revocations \cite{liu2015end},
        and Chrome only displays warnings on revoked certificates through CRLSet.
        Although CRLset is constantly updated, Chrome still consider my website is secure within a month after my server certificate was revoked.
        we think Chrome need to be improved on this.

\subsection{key usage and extended key usage}

According to RFC 5280, if a certificate contains both a key usage extension and an extended key usage extension,
    then both extensions MUST be processed independently
    and the certificate MUST only be used for a purpose consistent with both extensions.
    If there is no purpose consistent with both extensions, then the certificate MUST NOT be used for any purpose \cite{cooper2008rfc5280}.

For key usage and extended key usage of server certificate, there are two incorrect browser security warnings.
    First, Chrome, Edge, and IE does not display any warning on error of a server certificate that does not have extended key usage and has a incorrect key usage.
    Second, all the four browsers does not display any warning on error of a server certificate that with a correct extended key usage and a incorrect key usage.

% If a certificate contains both a key usage extension and an extended
%   key usage extension, then both extensions MUST be processed
 %  independently and the certificate MUST only be used for a purpose
  % consistent with both extensions.  If there is no purpose consistent
   %with both extensions, then the certificate MUST NOT be used for any
   %purpose.(RFC 5280)

\subsection{HPKP}
    Of the four browsers, only Chrome and Firefox support HPKP.
    Chrome and Firefox does not perform HPKP check when the certificate chain chains up to a root certificate installed by the user.
    Thus, If a malware installs its root certificate on the user's computer,
        it may defeat the protections of HPKP and successfully launch the man-in-the-middle attack.
    We think Chrome and Firefox need to be improved on this.

%To enable certificate chain validation, Chrome has access to two stores of trust anchors: certificates that are empowered as issuers. One trust anchor store is the system or public trust anchor store, and the other other is the local or private trust anchor store. The public store is provided as part of the operating system, and intended to authenticate public internet servers. The private store contains certificates installed by the user or the administrator of the client machine. Private intranet servers should authenticate themselves with certificates issued by a private trust anchor.

%Chrome does not perform pin validation when the certificate chain chains up to a private trust anchor. A key result of this policy is that private trust anchors can be used to proxy (or MITM) connections, even to pinned sites. “Data loss prevention” appliances, firewalls, content filters, and malware can use this feature to defeat the protections of key pinning.
% We deem this acceptable because the proxy or MITM can only be effective if the client machine has already been configured to trust the proxy’s issuing certificate ― that is, the client is already under the control of the person who controls the proxy (e.g. the enterprise’s IT administrator). If the client does not trust the private trust anchor, the proxy’s attempt to mediate the connection will fail as it should.

%In order to control the browsing behavior of the internal network, some companies often pre-set the self-signed certificate in the computer in the office area, and replace the HTTPS connection certificate in the gateway to obtain the information contained in the HTTPS traffic, detect and prevent the information leakage inside the company, which is a typical MITM attack. Some malware may also use the same way to attack a personal computer. Many computer applications will trigger the UAC of the Windows system during installation. After clicking and agreeing, the computer settings can be modified. After the malware spoofs the user's consent, you can modify the computer settings, such as burying your own root certificate. Eavesdrop on all traffic through a self-signed certificate and send sensitive information to the attacker.

\subsection{CN and SAN}
The four browsers have inconsistencies in checking CN and SAN.
When visiting a domain whose domain name is included in the CN field and it does not have SAN field, 
Chrome displays a B-level (Medium-Risk) warning, 和Firefox, Edge, and IE的处理方式不一样，可能会导致实用性的问题，
We think Chrome need to be improved on this.



\subsection{Certificate Extension}
Basic Constraint:
我们必须严格区分server certificate and CA certificate，不能将其混为一谈，
但是当一个server certificate的ca flag字段设为true时，Chrome，Edge和IE居然认为他是安全的,
We think this three browsers need to be improved on this

另外，如果一个CA进行了pathLenConstrait字段的设置，那么它的子CA应该遵守这个设置，
然而Firefox却将不遵守pathLenConstrait的错误，认为是安全的。
We think Firefox need to be improved on this.

Extended Key Usage and Key Usage:
According to RFC 5280, if a certificate contains both a key usage extension and an extended key usage extension,
    then both extensions MUST be processed independently
    and the certificate MUST only be used for a purpose consistent with both extensions.
    If there is no purpose consistent with both extensions, then the certificate MUST NOT be used for any purpose \cite{cooper2008rfc5280}.

For key usage and extended key usage of server certificate, there are two incorrect browser security warnings.
    First, Chrome, Edge, and IE does not display any warning on error of a server certificate that does not have extended key usage and has a incorrect key usage.
    Second, all the four browsers does not display any warning on error of a server certificate that with a correct extended key usage and a incorrect key usage.


